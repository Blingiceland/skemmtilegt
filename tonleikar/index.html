<!DOCTYPE html>
<html lang="is">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skatttekjur af T√≥nleikum - Reikniv√©l</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #ec4899 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #1f2937;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: backgroundMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes backgroundMove {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 12px;
            font-size: 3rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.2rem;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            animation: fadeInDown 0.6s ease-out 0.1s backwards;
        }

        .info-banner {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 5px solid #3b82f6;
            padding: 16px 24px;
            margin-bottom: 30px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out 0.2s backwards;
            flex-wrap: wrap;
        }

        .info-banner span {
            font-size: 1rem;
            color: #1f2937;
            font-weight: 600;
        }

        .info-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            white-space: nowrap;
        }

        .info-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 28px;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1f2937;
            margin: 0;
        }

        .modal-close {
            background: #ef4444;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 28px;
            color: #374151;
            line-height: 1.7;
        }

        .modal-body h4 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            margin-top: 20px;
            margin-bottom: 12px;
        }

        .modal-body h4:first-child {
            margin-top: 0;
        }

        .modal-body ul {
            margin-left: 24px;
            margin-bottom: 16px;
        }

        .modal-body li {
            margin-bottom: 8px;
        }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 35px;
            justify-content: center;
            flex-wrap: wrap;
            animation: fadeInUp 0.6s ease-out 0.3s backwards;
        }

        .btn {
            background: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .section:nth-child(4) {
            animation-delay: 0.4s;
        }

        .section:nth-child(5) {
            animation-delay: 0.5s;
        }

        .section:nth-child(6) {
            animation-delay: 0.6s;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .add-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 12px;
            margin-bottom: 12px;
            align-items: end;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .row-wages {
            grid-template-columns: 2fr 1fr auto;
        }

        .row-vat {
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
        }

        .row-alcohol {
            grid-template-columns: 1fr 1fr 1fr 1.5fr auto;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        input,
        select {
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        input:hover,
        select:hover {
            border-color: #cbd5e1;
        }

        .remove-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            font-weight: 700;
        }

        .remove-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .results .result-card:nth-child(1) {
            animation-delay: 0.7s;
        }

        .results .result-card:nth-child(2) {
            animation-delay: 0.8s;
        }

        .results .result-card:nth-child(3) {
            animation-delay: 0.9s;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .result-card.total {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #ec4899 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .result-card.total::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .result-card h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 14px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
            font-weight: 800;
            position: relative;
            z-index: 1;
        }

        .result-card.total h3 {
            border-bottom-color: rgba(255, 255, 255, 0.3);
        }

        .result-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 1rem;
            position: relative;
            z-index: 1;
        }

        .result-line.total-line {
            font-weight: 800;
            font-size: 1.3rem;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid rgba(0, 0, 0, 0.1);
        }

        .result-card.total .result-line.total-line {
            border-top-color: rgba(255, 255, 255, 0.3);
        }

        .result-value {
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .vat-detail {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .row,
            .row-wages,
            .row-vat,
            .row-alcohol {
                grid-template-columns: 1fr;
            }

            .results {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 20px;
            }

            .result-card {
                padding: 24px;
            }
        }

        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>

<body>
    <div class="container">
        <div style="text-align: right; margin-bottom: 10px;">
            <a href="/"
                style="color: rgba(255,255,255,0.8); text-decoration: none; font-weight: 600; border-bottom: 2px solid rgba(255,255,255,0.4);">üè†
                Heim</a>
        </div>
        <h1>üéµ Skatttekjur af T√≥nleikum</h1>
        <p class="subtitle">Reikniv√©l fyrir beinar skatttekjur r√≠kis og sveitarf√©laga</p>

        <div class="info-banner">
            <span>üí° √Å√¶tla√∞ir √∫treikningar mi√∞a√∞ vi√∞ 2026 forsendur</span>
            <button class="info-btn" onclick="toggleModal()">‚ÑπÔ∏è Sj√° n√°nar</button>
        </div>

        <!-- Modal Popup -->
        <div id="infoModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ö†Ô∏è Forsendur og Fyrirvari</h3>
                    <button class="modal-close" onclick="toggleModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <h4>Skattalegar forsendur:</h4>
                    <ul>
                        <li><strong>Me√∞al√∫tsvar:</strong> 14,94%</li>
                        <li><strong>L√¶gsta sta√∞grei√∞slu√ærep:</strong> 31,49%</li>
                        <li><strong>Tryggingagjald:</strong> 6,35%</li>
                    </ul>

                    <h4>√Åfengisgj√∂ld 2026 (kr per cl v√≠nanda):</h4>
                    <ul>
                        <li><strong>Bj√≥r:</strong> 156,45 kr/cl</li>
                        <li><strong>V√≠n:</strong> 142,50 kr/cl</li>
                        <li><strong>Sterkt √°fengi:</strong> 192,85 kr/cl</li>
                    </ul>

                    <h4>Mikilv√¶gt a√∞ hafa √≠ huga:</h4>
                    <ul>
                        <li>Raunt√∂lur r√°√∞ast af skattkortum einstaklinga, √∂√∞rum tekjum og VSK-skilum.</li>
                        <li>VSK er s√Ωndur sem <strong>nett√≥</strong> (√∫tskattur m√≠nus innskattur).</li>
                        <li>√ûetta er √°√¶tlun til vi√∞mi√∞unar, ekki endanleg skatta√∫treikningur.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary"
                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #f59e0b;"
                onclick="loadScenario('dillon')">üç∫ Bar Gigg</button>
            <button class="btn btn-primary" onclick="loadScenario('stort')">üé≠ St√≥rt T√≥nleikahald</button>
            <button class="btn btn-secondary" onclick="resetAll()">üîÑ Hreinsa Allt</button>
        </div>


        <!-- LAUN -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üí∞ Laun</h2>
            </div>
            <div id="wages-container"></div>
        </div>

        <!-- √ÅFENGI -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üç∫ √Åfengi</h2>
            </div>
            <div id="alcohol-container"></div>
        </div>

        <!-- VSK -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üßæ VSK (Vir√∞isaukaskattur)</h2>
            </div>
            <div id="vat-container"></div>
        </div>

        <!-- MI√êASALA -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üé´ Mi√∞asala</h2>
            </div>
            <div class="row">
                <div class="input-group">
                    <label>Heildartekjur af mi√∞as√∂lu (VSK-laust)</label>
                    <input type="number" id="ticket-sales" value="0" placeholder="0 kr"
                        onchange="updateTicketSales(parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Grei√∞slur til listamanns (dregst fr√°)</label>
                    <input type="number" id="artist-payment" value="0" placeholder="0 kr" disabled
                        style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            </div>
        </div>

        <!-- NI√êURST√ñ√êUR -->
        <div class="results" id="results">
            <div class="result-card">
                <h3>üèõÔ∏è R√≠ki√∞</h3>
                <div class="result-line">
                    <span>Tekjuskattur (r√≠kishluti):</span>
                    <span class="result-value" id="state-income">0 kr</span>
                </div>
                <div class="result-line">
                    <span>Tryggingagjald:</span>
                    <span class="result-value" id="state-payroll">0 kr</span>
                </div>
                <div class="result-line">
                    <span>Nett√≥ VSK:</span>
                    <span class="result-value" id="state-vat">0 kr</span>
                </div>
                <div class="result-line">
                    <span>√Åfengisgjald:</span>
                    <span class="result-value" id="state-alcohol">0 kr</span>
                </div>
                <div class="result-line total-line">
                    <span>R√≠ki√∞ samtals:</span>
                    <span class="result-value" id="state-total">0 kr</span>
                </div>
                <div class="vat-detail" id="vat-breakdown"></div>
            </div>

            <div class="result-card">
                <h3>üèòÔ∏è Sveitarf√©lag</h3>
                <div class="result-line">
                    <span>√ötsvar:</span>
                    <span class="result-value" id="municipal-tax">0 kr</span>
                </div>
                <div class="result-line total-line">
                    <span>Sveitarf√©lag samtals:</span>
                    <span class="result-value" id="municipal-total">0 kr</span>
                </div>
            </div>

            <div class="result-card total">
                <h3>üìä Yfirlit</h3>

                <!-- VELTA -->
                <div class="result-line">
                    <span>Samtals velta (m. VSK):</span>
                    <span class="result-value" id="total-revenue">0 kr</span>
                </div>
                <div style="font-size:0.85rem; padding-left:10px; opacity:0.8; margin-bottom:15px;">
                    <div id="revenue-breakdown"></div>
                </div>

                <!-- KOSTNA√êARLI√êIR -->
                <div class="result-line total-line" style="margin-top: 20px;">
                    <span>Kostna√∞arli√∞ir:</span>
                </div>
                <div id="expense-breakdown"
                    style="font-size:0.85rem; padding-left:10px; opacity:0.8; margin-bottom:15px;">
                </div>

                <!-- HLUTUR T√ìNLEIKAHALDARA -->
                <div class="result-line total-line"
                    style="margin-top: 20px; background: rgba(167, 243, 208, 0.1); padding: 15px; border-radius: 8px;">
                    <span style="color:#10b981; font-weight: 700;">Hlutur T√≥nleikahaldara:</span>
                    <span class="result-value" id="organizer-share" style="color:#10b981; font-weight: 700;">0 kr</span>
                </div>

                <!-- SKATTTEKJUR -->
                <div class="result-line total-line" style="margin-top: 20px;">
                    <span>Heildarskatttekjur:</span>
                    <span class="result-value" id="grand-total">0 kr</span>
                </div>
                <div id="tax-breakdown" style="font-size:0.85rem; padding-left:10px; opacity:0.8; margin-bottom:15px;">
                </div>

                <!-- √öTSVAR SVEITARF√âLAGS -->
                <div class="result-line" style="margin-top: 10px;">
                    <span>√ötsvar sveitarf√©lags:</span>
                    <span class="result-value" id="municipal-share">0 kr</span>
                </div>

                <!-- MISMUNUR -->
            </div>
        </div>
    </div>

    <!-- DISCLAIMER SECTION -->
    <div
        style="max-width: 1400px; margin: 40px auto; padding: 20px; background: rgba(251, 191, 36, 0.1); border-left: 4px solid #f59e0b; border-radius: 8px;">
        <h4 style="color: #f59e0b; margin-top: 0; font-size: 1.1rem;">‚ö†Ô∏è Mikilv√¶gt a√∞ hafa √≠ huga</h4>
        <p style="margin: 10px 0; line-height: 1.6; color: #d1d5db;">
            <strong>Launakostna√∞ur:</strong> Launali√∞ir √≠ √æessari reikniv√©l eru √°√¶tla√∞ur heildarlaunakostna√∞ur sem tekur
            mi√∞ af br√∫tt√≥launum, launatengdum gj√∂ldum og √∂√∞rum launatengdum kostna√∞i.
        </p>
        <p style="margin: 10px 0; line-height: 1.6; color: #d1d5db;">
            <strong>Raunverulegur grundv√∂llur:</strong> Sj√°lfgefin atbur√∞ad√¶mi (‚ÄûT√≥nleikagigg" og ‚ÄûSt√≥rt t√≥nleikahald")
            byggja √° raunverulegum kostna√∞arreikningum sl√≠kra vi√∞bur√∞a og endurspegla raunt√∂lur √∫r rekstri.
        </p>
        <p style="margin: 10px 0 0 0; line-height: 1.6; color: #9ca3af; font-size: 0.9rem;">
            √ûessi reikniv√©l er √¶tlu√∞ til lei√∞beiningar og √°√¶tlanager√∞ar. N√°kv√¶mar t√∂lur geta veri√∞ mismunandi eftir
            a√∞st√¶√∞um.
        </p>
    </div>

    <script>
        // ========================================
        // FORSENDUR (2026 DEFAULTS)
        // ========================================
        const HEILD_STADGREIDSLA = 0.3149;      // 31.49% heildar sta√∞grei√∞sla
        const MEDAL_UTSVAR = 0.1494;            // 14.94% me√∞al√∫tsvar
        const RIKISHLUTI_STADGREIDSLA = HEILD_STADGREIDSLA - MEDAL_UTSVAR; // 0.1655
        const TRYGGINGAGJALD = 0.0635;          // 6.35% tryggingagjald launagrei√∞anda

        // √Åfengisgj√∂ld 2026: kr per cl v√≠nanda √≠ 1 l√≠tra drykkjar
        const BEER_RATE_PER_CL = 156.45;      // 1. t√∂lul. - Bj√≥r
        const WINE_RATE_PER_CL = 142.50;      // 2. t√∂lul. - V√≠n
        const SPIRITS_RATE_PER_CL = 192.85;   // 3. t√∂lul. - Sterkt √°fengi

        // ========================================
        // DATA STRUCTURES (Legacy - kept for compatibility)
        // ========================================
        let wageRows = [];
        let vatRows = [];

        // ========================================
        // FORMATTING HELPER
        // ========================================
        function formatCurrency(amount) {
            return Math.round(amount).toLocaleString('is-IS') + ' kr';
        }

        function parseNumber(str) {
            return parseFloat(str.replace(/[^\d.-]/g, '')) || 0;
        }

        // ========================================
        // FIXED WAGE CATEGORIES
        // ========================================
        // DYNAMIC WAGE CATEGORIES
        // ========================================
        // using an array to guarantee order and allow additions
        let wageItems = [
            { id: 'listafolk', label: 'Listaf√≥lk', amount: 0, isCustom: false },
            { id: 'hlj√≥√∞ma√∞ur', label: 'Hlj√≥√∞ma√∞ur', amount: 0, isCustom: false },
            { id: 'starfsf√≥lk', label: 'Starfsf√≥lk', amount: 0, isCustom: false },
            { id: '√ærif', label: '√ûrif', amount: 0, isCustom: false },
            { id: 'oryggisgaesla', label: '√ñryggisg√¶sla', amount: 0, isCustom: false },
            { id: 'loggaesla', label: 'L√∂gg√¶sla', amount: 0, isCustom: false }
        ];

        // ========================================
        // TICKET SALES (VSK-free revenue)
        // ========================================
        let ticketSales = 0;
        let artistPayment = 0;

        function updateTicketSales(value) {
            ticketSales = value;
            calculate();
        }

        function updateArtistPayment(value) {
            artistPayment = value;
            calculate();
        }

        function renderWages() {
            const container = document.getElementById('wages-container');
            container.innerHTML = '';

            wageItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'row row-wages';

                // Label input (disabled for fixed, enabled for custom)
                const labelInput = item.isCustom
                    ? `<input type="text" value="${item.label}" onchange="updateWageLabel(${index}, this.value)" placeholder="L√Ωsing..." style="font-weight: 600;">`
                    : `<input type="text" value="${item.label}" disabled style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">`;

                // Remove button for custom rows
                const removeBtn = item.isCustom
                    ? `<button class="remove-btn" onclick="removeWageRow(${index})" style="padding: 10px; font-size: 1rem;">üóëÔ∏è</button>`
                    : ``;

                div.innerHTML = `
                    <div class="input-group">
                        <label>${item.isCustom ? 'L√Ωsing' : item.label}</label>
                        ${labelInput}
                    </div>
                    <div class="input-group">
                        <label>Upph√¶√∞ (kr)</label>
                        <input type="number" value="${item.amount}" 
                               onchange="updateWageAmount(${index}, parseFloat(this.value) || 0)">
                    </div>
                `;

                // Add remove button column if custom
                if (item.isCustom) {
                    const btnDiv = document.createElement('div');
                    btnDiv.innerHTML = removeBtn;
                    div.appendChild(btnDiv);
                    div.style.gridTemplateColumns = "2fr 1fr auto"; // Ensure 3 columns
                }

                container.appendChild(div);
            });

            // Add "Add Row" button at the bottom
            const addDiv = document.createElement('div');
            addDiv.style.marginTop = '20px';
            addDiv.style.textAlign = 'center';
            addDiv.innerHTML = `<button class="add-btn" onclick="addWageRow()">+ B√¶ta vi√∞ launali√∞</button>`;
            container.appendChild(addDiv);
        }

        function updateWageAmount(index, value) {
            wageItems[index].amount = value;

            // If this is Listaf√≥lk, sync with artist payment
            if (wageItems[index].id === 'listafolk') {
                artistPayment = value;
                document.getElementById('artist-payment').value = value;
            }

            calculate();
        }

        function updateWageLabel(index, value) {
            wageItems[index].label = value;
        }

        function addWageRow() {
            wageItems.push({ id: `custom_${Date.now()}`, label: '', amount: 0, isCustom: true });
            renderWages();
        }

        function removeWageRow(index) {
            wageItems.splice(index, 1);
            renderWages();
            calculate();
        }

        // ========================================
        // FIXED VSK CATEGORIES
        // ========================================
        let vsk = {
            leiga: { amount: 0, vskRate: 0.24 },
            markadur: { amount: 0, vskRate: 0.24 }
        };

        function renderVAT() {
            const container = document.getElementById('vat-container');
            container.innerHTML = '';

            // 1. Leiga √° b√∫na√∞i (manual input, innskattur)
            renderVATRow(container, 'Leiga √° b√∫na√∞i', 'leiga');

            // 2. Marka√∞skostna√∞ur (manual input, innskattur)
            renderVATRow(container, 'Marka√∞skostna√∞ur', 'markadur');

            // 3. Matur & Drykkur (auto from alcohol sales, √∫tskattur)
            const bj√≥rRevenue = alcohol.bj√≥r.pints * alcohol.bj√≥r.pricePerPint;
            const sterktRevenue = alcohol.sterkt.shots * alcohol.sterkt.pricePerShot;
            const v√≠nRevenue = alcohol.v√≠n.bottles * alcohol.v√≠n.pricePerBottle;
            const totalAlcoholRevenue = bj√≥rRevenue + sterktRevenue + v√≠nRevenue;

            // Revenue includes 11% VSK, so base = revenue / 1.11
            const alcoholBase = totalAlcoholRevenue / 1.11;
            const alcoholVSK = totalAlcoholRevenue - alcoholBase;

            let div = document.createElement('div');
            div.className = 'row row-vat';
            div.innerHTML = `
                <div class="input-group">
                    <label>Matur & Drykkur (11%)</label>
                    <input type="text" value="Matur & Drykkur" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Upph√¶√∞ √°n VSK (kr)</label>
                    <input type="text" value="${formatCurrency(alcoholBase)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>VSK upph√¶√∞ (kr)</label>
                    <input type="text" value="${formatCurrency(alcoholVSK)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Samtals me√∞ VSK (kr)</label>
                    <input type="text" value="${formatCurrency(totalAlcoholRevenue)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            `;
            container.appendChild(div);

            // 4. Innskattur (COGS input VAT - calculated from alcohol sales)
            const COGS_RATE = 0.30;
            const totalCOGS = totalAlcoholRevenue * COGS_RATE;
            const cogsBase = totalCOGS / 1.11; // Base without VAT
            const cogsVAT = totalCOGS - cogsBase; // 11% VAT (this is the input VAT)

            let cogsDiv = document.createElement('div');
            cogsDiv.className = 'row row-vat';
            cogsDiv.innerHTML = `
                <div class="input-group">
                    <label>Innskattur (11%)</label>
                    <input type="text" value="Innskattur" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e;">
                </div>
                <div class="input-group">
                    <label>Upph√¶√∞ √°n VSK (kr)</label>
                    <input type="text" value="${formatCurrency(cogsBase)}" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e;">
                </div>
                <div class="input-group">
                    <label>Innskattur (kr)</label>
                    <input type="text" value="${formatCurrency(cogsVAT)}" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e;">
                </div>
                <div class="input-group">
                    <label>Samtals me√∞ VSK (kr)</label>
                    <input type="text" value="${formatCurrency(totalCOGS)}" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e;">
                </div>
            `;
            container.appendChild(cogsDiv);
        }

        function renderVATRow(container, label, key) {
            const amount = vsk[key].amount;
            const vskAmt = amount * vsk[key].vskRate;
            const total = amount + vskAmt;

            const div = document.createElement('div');
            div.className = 'row row-vat';
            div.innerHTML = `
                <div class="input-group">
                    <label>${label} (${vsk[key].vskRate * 100}%)</label>
                    <input type="text" value="${label}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Upph√¶√∞ √°n VSK (kr)</label>
                    <input type="number" value="${amount}" 
                           onchange="updateVSK('${key}', 'amount', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>VSK upph√¶√∞ (kr)</label>
                    <input type="text" value="${formatCurrency(vskAmt)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Samtals me√∞ VSK (kr)</label>
                    <input type="text" value="${formatCurrency(total)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            `;
            container.appendChild(div);
        }

        function updateVSK(key, field, value) {
            vsk[key][field] = value;
            calculate();
        }

        // ========================================
        // FIXED ALCOHOL CATEGORIES
        // ========================================
        let alcohol = {
            bj√≥r: { pints: 0, pricePerPint: 0, abv: 4.5 },        // 1 pint = 0.5L
            sterkt: { shots: 0, pricePerShot: 0, abv: 40.0 },     // 1 shot = 3cl
            v√≠n: { bottles: 0, pricePerBottle: 0, abv: 12.5 }     // 1 bottle = 750ml
        };

        function renderAlcohol() {
            const container = document.getElementById('alcohol-container');
            container.innerHTML = '';

            // Bj√≥r (pints)
            const bj√≥rLiters = alcohol.bj√≥r.pints * 0.5;
            const bj√≥rExcise = bj√≥rLiters * alcohol.bj√≥r.abv * BEER_RATE_PER_CL;
            const bj√≥rRevenue = alcohol.bj√≥r.pints * alcohol.bj√≥r.pricePerPint;

            let div = document.createElement('div');
            div.className = 'row row-alcohol';
            div.innerHTML = `
                <div class="input-group">
                    <label>Bj√≥r (4.5% ABV)</label>
                    <input type="text" value="Bj√≥r" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Pints (0.5L)</label>
                    <input type="number" value="${alcohol.bj√≥r.pints}" step="1"
                           onchange="updateAlcohol('bj√≥r', 'pints', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Ver√∞/pint (kr)</label>
                    <input type="number" value="${alcohol.bj√≥r.pricePerPint}" step="1"
                           onchange="updateAlcohol('bj√≥r', 'pricePerPint', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Heildarsala (kr)</label>
                    <input type="text" value="${formatCurrency(bj√≥rRevenue)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>√Å√¶tla√∞ √°fengisgjald</label>
                    <input type="text" value="${formatCurrency(bj√≥rExcise)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            `;
            container.appendChild(div);

            // Sterkt (shots/einfaldir)
            const sterktLiters = alcohol.sterkt.shots * 0.03;
            const sterktExcise = sterktLiters * alcohol.sterkt.abv * SPIRITS_RATE_PER_CL;
            const sterktRevenue = alcohol.sterkt.shots * alcohol.sterkt.pricePerShot;

            div = document.createElement('div');
            div.className = 'row row-alcohol';
            div.innerHTML = `
                <div class="input-group">
                    <label>Sterkt √°fengi (40% ABV)</label>
                    <input type="text" value="Sterkt √°fengi" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Einfaldir (3cl)</label>
                    <input type="number" value="${alcohol.sterkt.shots}" step="1"
                           onchange="updateAlcohol('sterkt', 'shots', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Ver√∞/einfaldur (kr)</label>
                    <input type="number" value="${alcohol.sterkt.pricePerShot}" step="1"
                           onchange="updateAlcohol('sterkt', 'pricePerShot', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Heildarsala (kr)</label>
                    <input type="text" value="${formatCurrency(sterktRevenue)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>√Å√¶tla√∞ √°fengisgjald</label>
                    <input type="text" value="${formatCurrency(sterktExcise)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            `;
            container.appendChild(div);

            // V√≠n (bottles)
            const v√≠nLiters = alcohol.v√≠n.bottles * 0.75; // 750ml per bottle
            const v√≠nExcise = v√≠nLiters * alcohol.v√≠n.abv * WINE_RATE_PER_CL;
            const v√≠nRevenue = alcohol.v√≠n.bottles * alcohol.v√≠n.pricePerBottle;

            div = document.createElement('div');
            div.className = 'row row-alcohol';
            div.innerHTML = `
                <div class="input-group">
                    <label>V√≠n (12.5% ABV)</label>
                    <input type="text" value="V√≠n" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>Fl√∂skur (750ml)</label>
                    <input type="number" value="${alcohol.v√≠n.bottles}" step="1"
                           onchange="updateAlcohol('v√≠n', 'bottles', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Ver√∞/fl√∂sku (kr)</label>
                    <input type="number" value="${alcohol.v√≠n.pricePerBottle}" step="1"
                           onchange="updateAlcohol('v√≠n', 'pricePerBottle', parseFloat(this.value) || 0)">
                </div>
                <div class="input-group">
                    <label>Heildarsala (kr)</label>
                    <input type="text" value="${formatCurrency(v√≠nRevenue)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
                <div class="input-group">
                    <label>√Å√¶tla√∞ √°fengisgjald</label>
                    <input type="text" value="${formatCurrency(v√≠nExcise)}" disabled
                           style="background: #f3f4f6; cursor: not-allowed; font-weight: 600;">
                </div>
            `;
            container.appendChild(div);

            // TOTAL ROW
            const totalRevenue = bj√≥rRevenue + sterktRevenue + v√≠nRevenue;
            const totalExcise = bj√≥rExcise + sterktExcise + v√≠nExcise;

            div = document.createElement('div');
            div.className = 'row row-alcohol';
            div.style.borderTop = '2px solid rgba(255,255,255,0.3)';
            div.style.marginTop = '15px';
            div.style.paddingTop = '15px';
            div.innerHTML = `
                <div class="input-group">
                    <label style="font-weight: 700;">SAMTALS</label>
                    <input type="text" value="Samtals" disabled
                           style="background: #e0e7ff; cursor: not-allowed; font-weight: 700; color: #4338ca;">
                </div>
                <div class="input-group">
                    <label>&nbsp;</label>
                    <input type="text" value="" disabled style="background: transparent; border: none;">
                </div>
                <div class="input-group">
                    <label>&nbsp;</label>
                    <input type="text" value="" disabled style="background: transparent; border: none;">
                </div>
                <div class="input-group">
                    <label style="font-weight: 700;">Heildarsala</label>
                    <input type="text" value="${formatCurrency(totalRevenue)}" disabled
                           style="background: #e0e7ff; cursor: not-allowed; font-weight: 700; color: #4338ca;">
                </div>
                <div class="input-group">
                    <label style="font-weight: 700;">Samtals √°fengisgjald</label>
                    <input type="text" value="${formatCurrency(totalExcise)}" disabled
                           style="background: #e0e7ff; cursor: not-allowed; font-weight: 700; color: #4338ca;">
                </div>
            `;
            container.appendChild(div);

            // COGS ROW (Cost of Goods Sold)
            const COGS_RATE = 0.30; // 30% of sales
            const totalCOGS = totalRevenue * COGS_RATE;

            div = document.createElement('div');
            div.className = 'row row-alcohol';
            div.style.marginTop = '10px';
            div.innerHTML = `
                <div class="input-group">
                    <label style="font-weight: 600; font-size: 0.9rem;">Kostna√∞arver√∞ seldrar v√∂ru</label>
                    <input type="text" value="V√∂rukaup" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e; font-size: 0.9rem;">
                </div>
                <div class="input-group">
                    <label style="font-size: 0.85rem; opacity: 0.7;">~30% af s√∂lu</label>
                    <input type="text" value="" disabled style="background: transparent; border: none;">
                </div>
                <div class="input-group">
                    <label>&nbsp;</label>
                    <input type="text" value="" disabled style="background: transparent; border: none;">
                </div>
                <div class="input-group">
                    <label style="font-weight: 600; font-size: 0.9rem;">Kostna√∞ur</label>
                    <input type="text" value="${formatCurrency(totalCOGS)}" disabled
                           style="background: #fef3c7; cursor: not-allowed; font-weight: 600; color: #92400e;">
                </div>
                <div class="input-group">
                    <label style="font-size: 0.85rem; opacity: 0.7;">Mi√∞a√∞ vi√∞ Dillon</label>
                    <input type="text" value="" disabled style="background: transparent; border: none;">
                </div>
            `;
            container.appendChild(div);
        }

        function updateAlcohol(key, field, value) {
            alcohol[key][field] = value;
            renderAlcohol();
            renderVAT(); // Update VSK to show alcohol revenue
            calculate();
        }


        // ========================================
        // CALCULATIONS
        // ========================================
        function calculate() {
            // A) LAUN (Income Tax, Municipal Tax, Payroll Tax)
            let stateIncome = 0;
            let statePayroll = 0;
            let municipalTax = 0;

            wageItems.forEach(row => {
                const amount = row.amount;

                // Gross tax (no personal allowance)
                const grossTax = amount * HEILD_STADGREIDSLA;

                // Net tax is same as gross because no personal allowance
                const netTax = grossTax;

                // Ratios for splitting net tax
                const municipalRatio = MEDAL_UTSVAR / HEILD_STADGREIDSLA;
                const stateRatio = RIKISHLUTI_STADGREIDSLA / HEILD_STADGREIDSLA;

                // Split net tax
                const municipalFromWage = netTax * municipalRatio;
                const stateIncomeFromWage = netTax * stateRatio;

                // Payroll tax
                const statePayrollFromWage = amount * TRYGGINGAGJALD;

                municipalTax += municipalFromWage;
                stateIncome += stateIncomeFromWage;
                statePayroll += statePayrollFromWage;
            });

            // Calculate alcohol revenue FIRST (needed for VSK and COGS calculations)
            const bj√≥rRev = alcohol.bj√≥r.pints * alcohol.bj√≥r.pricePerPint;
            const sterktRev = alcohol.sterkt.shots * alcohol.sterkt.pricePerShot;
            const v√≠nRev = alcohol.v√≠n.bottles * alcohol.v√≠n.pricePerBottle;
            const alcoholRevenue = bj√≥rRev + sterktRev + v√≠nRev;

            // B) VSK
            let outputVAT = 0;
            let inputVAT = 0;

            // 0. V√∂rukaup (innskattur) - COGS includes 11% VAT
            const COGS_RATE = 0.30;
            const totalCOGS = alcoholRevenue * COGS_RATE;
            const cogsInputVAT = totalCOGS * (11 / 111);
            inputVAT += cogsInputVAT;

            // 1. Leiga √° b√∫na√∞i (innskattur)
            inputVAT += vsk.leiga.amount * vsk.leiga.vskRate;

            // 1b. Marka√∞skostna√∞ur (innskattur)
            inputVAT += vsk.markadur.amount * vsk.markadur.vskRate;

            // 2. Matur & Drykkur from alcohol (√∫tskattur)
            const bj√≥rRevenue = alcohol.bj√≥r.pints * alcohol.bj√≥r.pricePerPint;
            const sterktRevenue = alcohol.sterkt.shots * alcohol.sterkt.pricePerShot;
            const v√≠nRevenue = alcohol.v√≠n.bottles * alcohol.v√≠n.pricePerBottle;
            const totalAlcoholRevenue = bj√≥rRevenue + sterktRevenue + v√≠nRevenue;

            // Revenue includes 11% VSK: base = revenue / 1.11
            const alcoholBase = totalAlcoholRevenue / 1.11;
            const alcoholVAT = totalAlcoholRevenue - alcoholBase;
            outputVAT += alcoholVAT;

            // Net VSK (Output - Input)
            // If Net is positive, you pay. If negative, you get a refund (or treated as 0 for "revenue" context usually, but here 'Nett√≥ VSK' might be negative)
            // Let's keep it simple: Nett√≥ = √ötskattur - Innskattur.
            const netVAT = outputVAT - inputVAT;


            // C) √ÅFENGI (Excise Duty)
            let alcoholExcise = 0;

            // Bj√≥r
            const bj√≥rLiters = alcohol.bj√≥r.pints * 0.5;
            alcoholExcise += bj√≥rLiters * alcohol.bj√≥r.abv * BEER_RATE_PER_CL;

            // Sterkt
            const sterktLiters = alcohol.sterkt.shots * 0.03;
            alcoholExcise += sterktLiters * alcohol.sterkt.abv * SPIRITS_RATE_PER_CL;

            // V√≠n (bottles to liters)
            const v√≠nLiters = alcohol.v√≠n.bottles * 0.75;
            alcoholExcise += v√≠nLiters * alcohol.v√≠n.abv * WINE_RATE_PER_CL;


            // D) SAMT√ñLUR
            // R√≠ki√∞ f√¶r: Tekjuskattur + Tryggingagjald + Nett√≥ VSK + √Åfengisgjald
            const stateTotal = stateIncome + statePayroll + netVAT + alcoholExcise;

            // Sveitarf√©lag f√¶r: √ötsvar
            const municipalTotal = municipalTax;

            // Grand Total (Taxes)
            const grandTotal = stateTotal + municipalTotal;

            // E) SJ√ì√êUR & HLUTF√ñLL (Retained Earnings)
            // Total Revenue (inc VSK)
            // Need to sum sources. 
            // - Leiga revenue is typically B2B (so we assume it was an income). But wait, leiga is usually an expense input for the event holder.
            // Let's assume for this calculator:
            // Revenue Sources = Alcohol Sales (inc VSK) + Ticket Sales (implicit? No ticket sales input yet).
            // Actually, the calculator doesn't have "Ticket Revenue" input, only Expense Inputs (Wages, Rent) and Alcohol Revenue.
            // So "Total Revenue" for this specific context = Alcohol Revenue.
            // Expenses = Gross Wages + Gross Rent (inc VSK).

            // Expenses:
            let totalGrossWages = 0;
            wageItems.forEach(row => totalGrossWages += row.amount);

            const totalGrossRent = vsk.leiga.amount * (1 + vsk.leiga.vskRate);
            const totalGrossMarketing = vsk.markadur.amount * (1 + vsk.markadur.vskRate);

            // Net Ticket Revenue (after artist payment)
            const netTicketRevenue = ticketSales - artistPayment;

            // Total Revenue = Alcohol (with VSK) + Net Tickets
            const totalRevenue = alcoholRevenue + netTicketRevenue;

            // Retained Earnings (Cash in hand after paying everyone)
            // Logic: Revenue - (Total Taxes Paid to Gov? No, that double counts).
            // Better: Revenue - TotalCosts.
            // Costs = Net Wages Paid to Staff + Rent Paid to Supplier + Taxes Paid to Gov (PAYE + VAT + Excise).
            // Actually, simpler: 
            // Cash In = Total Revenue.
            // Cash Out = Net Wages (to staff) + Rent (to supplier) + All Taxes (to State/Muni).

            // Net Wages to Staff = Gross Wages - (StateIncome + MunicipalTax).
            // (Payroll Tax is paid by employer on top, but 'amount' in wages usually means Gross Salary. 
            // Wait, does 'amount' include payroll tax? Usually "Launakostna√∞ur" = Gross + Payroll. 
            // Let's assume 'amount' is Gross Wages (Salary). Payroll Tax is calculated ON TOP.
            // So Total Cost of Employment = Gross Wages + Payroll Tax.
            // But 'Net Wages' received by employee = Gross Wages - Tax.
            // The Event Holder pays: Gross Wages (to employee+gov) + Payroll Tax (to gov).
            // So Event Holder Cost = Gross Wages + Payroll Tax.

            // Total Cash Out = (Gross Wages + StatePayroll) + Gross Rent + Net VAT Payment + Alcohol Excise.
            // Wait, Net VAT Payment is part of the tax bill.
            // Rent VSK is Input VAT. Alcohol VSK is Output VAT.
            // Payment to Gov = OutputVAT - InputVAT + Excise + PAYE + Payroll.
            // Payment to Landlord = Rent (ex VAT) + RentVAT.
            // Payment to Staff = Gross Wages - PAYE.
            // THIS IS GETTING COMPLICATED.

            // SIMPLER VIEW: Result = Revenue - Expenses - Taxes.
            // Revenue = TotalRevenue.
            // Expenses (Ex Taxes) = Gross Wages + Rent. (This assumes Wages 'amount' is the cost. If 'amount' is salary, cost is amount + payroll).
            // Let's settle: 'amount' is Gross Salary.
            // Operating Cost = Gross Wages + Rent (ex VAT). 
            // Taxes = PAYE (deducted from wages, so not an *extra* cost to company, but part of Gross).
            // Payroll Tax = Extra cost.
            // VAT = Net VAT paid.
            // Excise = Extra cost.

            // Total Cost = Gross Wages + (Gross Wages * TRYGGINGAGJALD) + Rent (ex VAT) + Net VAT + Alcohol Excise.
            // Profit = Total Revenue (ex VAT) - (Gross Wages * 1.0635) - Rent (ex VAT) - Alcohol Excise.
            // Wait, Revenue is Gross.

            // Let's do "Cash Flow":
            // In: TotalRevenue (Gross)
            // Out:
            //  - Net Wages (Gross - PAYE/Muni) -> To Staff
            //  - Rent (Gross) -> To Supplier
            //  - Taxes (GrandTotal: PAYE + Muni + Payroll + NetVAT + Excise) -> To Gov
            // Balance = In - Out.

            // Net Wages Calculation:
            let totalNetWagesToStaff = 0;
            wageItems.forEach(row => {
                const gross = row.amount;
                const grossTax = gross * HEILD_STADGREIDSLA;
                totalNetWagesToStaff += (gross - grossTax);
            });

            const cashOut = totalNetWagesToStaff + totalGrossRent + totalGrossMarketing + grandTotal;
            const retainedEarnings = totalRevenue - cashOut;

            // Ratios
            let alcoholTaxRatioRevenue = 0;
            if (alcoholRevenue > 0) {
                alcoholTaxRatioRevenue = (alcoholExcise / alcoholRevenue) * 100;
            }

            let alcoholTaxRatioProfit = 0;
            if (retainedEarnings > 0) {
                alcoholTaxRatioProfit = (alcoholExcise / retainedEarnings) * 100;
            } else {
                alcoholTaxRatioProfit = 0; // or infinite
            }

            // UPDATE UI
            document.getElementById('state-income').textContent = formatCurrency(stateIncome);
            document.getElementById('state-payroll').textContent = formatCurrency(statePayroll);
            document.getElementById('state-vat').textContent = formatCurrency(netVAT);
            document.getElementById('state-alcohol').textContent = formatCurrency(alcoholExcise);
            document.getElementById('state-total').textContent = formatCurrency(stateTotal);

            document.getElementById('municipal-tax').textContent = formatCurrency(municipalTax);
            document.getElementById('municipal-total').textContent = formatCurrency(municipalTotal);

            // UPDATE UI
            document.getElementById('total-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('grand-total').textContent = formatCurrency(grandTotal);

            // Revenue Breakdown (alcohol and tickets)
            const revenueBreakdownHTML = `
                <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Tekjur af v√∂ru (√°fengi):</span> <span>${formatCurrency(alcoholRevenue)}</span></div>
                ${netTicketRevenue > 0 ? `<div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Mi√∞asala:</span> <span>${formatCurrency(netTicketRevenue)}</span></div>` : ''}
            `;
            document.getElementById('revenue-breakdown').innerHTML = revenueBreakdownHTML;

            // Expense Breakdown
            const totalWages = wageItems.reduce((sum, item) => sum + item.amount, 0);
            const netCOGS = totalCOGS - cogsInputVAT; // COGS minus input VAT
            const expenseBreakdownHTML = `
                <div style="display: flex; justify-content: space-between;"><span>Laun (samtals):</span> <span>${formatCurrency(totalWages)}</span></div>
                <div style="display: flex; justify-content: space-between;"><span>V√∂rukaup (nett√≥):</span> <span>${formatCurrency(netCOGS)}</span></div>
                <div style="font-size: 0.8em; opacity: 0.7; padding-left: 10px; margin-top: -5px;">
                    <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Br√∫tt√≥ m. VSK:</span> <span>${formatCurrency(totalCOGS)}</span></div>
                    <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Innskattur:</span> <span>-${formatCurrency(cogsInputVAT)}</span></div>
                </div>
                ${totalGrossRent > 0 ? `<div style="display: flex; justify-content: space-between;"><span>Leiga (m. VSK):</span> <span>${formatCurrency(totalGrossRent)}</span></div>` : ''}
                ${totalGrossMarketing > 0 ? `<div style="display: flex; justify-content: space-between;"><span>Marka√∞skostna√∞ur (m. VSK):</span> <span>${formatCurrency(totalGrossMarketing)}</span></div>` : ''}
            `;
            document.getElementById('expense-breakdown').innerHTML = expenseBreakdownHTML;

            // Organizer Share (Revenue - All Expenses - All Taxes)
            // Use net COGS for actual expense calculation
            const totalExpenses = totalWages + netCOGS + totalGrossRent + totalGrossMarketing;
            const organizerShare = totalRevenue - totalExpenses - grandTotal - municipalTotal;

            // Conditional color: green if positive, red if negative
            const shareColor = organizerShare >= 0 ? '#10b981' : '#ef4444';
            const shareElement = document.getElementById('organizer-share');
            shareElement.textContent = formatCurrency(organizerShare);
            shareElement.style.color = shareColor;

            // Update parent container background color and add skull if negative
            const shareContainer = shareElement.parentElement;
            const labelSpan = shareContainer.querySelector('span:first-child');

            if (organizerShare >= 0) {
                shareContainer.style.background = 'rgba(167, 243, 208, 0.1)';
                labelSpan.style.color = '#10b981';
                labelSpan.innerHTML = 'Hlutur T√≥nleikahaldara:';
            } else {
                shareContainer.style.background = 'rgba(254, 202, 202, 0.1)';
                labelSpan.style.color = '#ef4444';
                labelSpan.innerHTML = 'üíÄ Hlutur T√≥nleikahaldara:';
            }

            // Municipal Tax (separate display)
            document.getElementById('municipal-share').textContent = formatCurrency(municipalTotal);

            // Detailed Tax Breakdown (excluding municipal tax since it's shown separately)
            const taxBreakdownHTML = `
                <div style="display: flex; justify-content: space-between;"><span>VSK (nett√≥):</span> <span>${formatCurrency(netVAT)}</span></div>
                <div style="display: flex; justify-content: space-between;"><span>√ötsvar:</span> <span>${formatCurrency(municipalTotal)}</span></div>
                <div style="display: flex; justify-content: space-between;"><span>Tryggingagjald:</span> <span>${formatCurrency(statePayroll)}</span></div>
                <div style="display: flex; justify-content: space-between;"><span>√Åfengisgjald:</span> <span>${formatCurrency(alcoholExcise)}</span></div>
                <div style="display: flex; justify-content: space-between;"><span>Sta√∞grei√∞sla:</span> <span>${formatCurrency(stateIncome)}</span></div>
            `;
            document.getElementById('tax-breakdown').innerHTML = taxBreakdownHTML;

            // VAT breakdown details
            const vatBreakdown = `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #e5e7eb; font-size: 0.9em; color: #6b7280;">
                    <strong>Sundurli√∞un VSK:</strong><br>
                    <div style="display: flex; justify-content: space-between;"><span>√ötskattur (sala):</span> <span>${formatCurrency(outputVAT)}</span></div>
                    <div style="display: flex; justify-content: space-between;"><span>Innskattur (a√∞f√∂ng):</span> <span>-${formatCurrency(inputVAT)}</span></div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #e5e7eb; font-size: 0.85em; opacity: 0.8;">
                        <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ V√∂rukaup:</span> <span>-${formatCurrency(cogsInputVAT)}</span></div>
                        <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Leiga:</span> <span>-${formatCurrency(vsk.leiga.amount * vsk.leiga.vskRate)}</span></div>
                        <div style="display: flex; justify-content: space-between;"><span>‚Ä¢ Marka√∞skostna√∞ur:</span> <span>-${formatCurrency(vsk.markadur.amount * vsk.markadur.vskRate)}</span></div>
                    </div>
                </div>
            `;
            document.getElementById('vat-breakdown').innerHTML = vatBreakdown;
        }

        // ========================================
        // EXAMPLE & RESET
        // ========================================
        function setWage(id, amount) {
            const item = wageItems.find(w => w.id === id);
            if (item) item.amount = amount;
        }

        function loadScenario(type) {
            resetDataStructures();

            if (type === 'dillon') {
                setWage('listafolk', 75000);
                setWage('hlj√≥√∞ma√∞ur', 40000);
                setWage('starfsf√≥lk', 30000);
                setWage('√ærif', 15000);
                setWage('oryggisgaesla', 20000);

                ticketSales = 75000; // Small venue ticket sales
                document.getElementById('ticket-sales').value = ticketSales;

                alcohol.bj√≥r = { pints: 80, pricePerPint: 1500, abv: 4.5 };
                alcohol.sterkt = { shots: 50, pricePerShot: 1600, abv: 40.0 };
                alcohol.v√≠n = { bottles: 2, pricePerBottle: 6000, abv: 12.5 };

                vsk.leiga = { amount: 0, vskRate: 0.24 };
                vsk.markadur = { amount: 0, vskRate: 0.24 };

            } else if (type === 'stort') {
                setWage('listafolk', 2500000);
                setWage('hlj√≥√∞ma√∞ur', 250000);
                setWage('starfsf√≥lk', 400000);
                setWage('√ærif', 100000);
                setWage('oryggisgaesla', 0); // User will provide
                setWage('loggaesla', 0);    // User will provide

                ticketSales = 5000000; // Large event ticket sales
                document.getElementById('ticket-sales').value = ticketSales;

                alcohol.bj√≥r = { pints: 800, pricePerPint: 1400, abv: 5.0 };
                alcohol.sterkt = { shots: 400, pricePerShot: 1800, abv: 40.0 };
                alcohol.v√≠n = { bottles: 60, pricePerBottle: 7500, abv: 13.0 };

                vsk.leiga = { amount: 500000, vskRate: 0.24 };
                vsk.markadur = { amount: 150000, vskRate: 0.24 };
            }

            renderWages();
            renderAlcohol();
            renderVAT();
            calculate();
        }

        function resetDataStructures() {
            wageItems = [
                { id: 'listafolk', label: 'Listaf√≥lk', amount: 0, isCustom: false },
                { id: 'hlj√≥√∞ma√∞ur', label: 'Hlj√≥√∞ma√∞ur', amount: 0, isCustom: false },
                { id: 'starfsf√≥lk', label: 'Starfsf√≥lk', amount: 0, isCustom: false },
                { id: '√ærif', label: '√ûrif', amount: 0, isCustom: false },
                { id: 'oryggisgaesla', label: '√ñryggisg√¶sla', amount: 0, isCustom: false },
                { id: 'loggaesla', label: 'L√∂gg√¶sla', amount: 0, isCustom: false }
            ];

            ticketSales = 0;
            artistPayment = 0;
            document.getElementById('ticket-sales').value = 0;
            document.getElementById('artist-payment').value = 0;

            alcohol.bj√≥r = { pints: 0, pricePerPint: 0, abv: 4.5 };
            alcohol.sterkt = { shots: 0, pricePerShot: 0, abv: 40.0 };
            alcohol.v√≠n = { bottles: 0, pricePerBottle: 0, abv: 12.5 };

            vsk.leiga = { amount: 0, vskRate: 0.24 };
            vsk.markadur = { amount: 0, vskRate: 0.24 };
        }

        function resetAll() {
            resetDataStructures();
            renderWages();
            renderAlcohol();
            renderVAT();
            calculate();
        }

        // ========================================
        // MODAL TOGGLE
        // ========================================
        function toggleModal() {
            const modal = document.getElementById('infoModal');
            modal.classList.toggle('active');
        }

        // Close modal when clicking outside
        window.onclick = function (event) {
            const modal = document.getElementById('infoModal');
            if (event.target === modal) {
                modal.classList.remove('active');
            }
        }

        // ========================================
        // INITIALIZE
        // ========================================
        renderWages();
        renderAlcohol();
        renderVAT();
        calculate();
    </script>
</body>

</html>