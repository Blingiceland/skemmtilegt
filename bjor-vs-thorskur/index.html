<!DOCTYPE html>
<html lang="is">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bj√≥r vs. √ûorskur - Samanbur√∞ur</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 50%, #b91c1c 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #1f2937;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: backgroundMove 25s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes backgroundMove {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(40px, 40px);
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .nav-back {
            text-align: right;
            margin-bottom: 20px;
        }

        .nav-back a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.4);
            padding-bottom: 2px;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 12px;
            font-size: 3rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.2rem;
            font-weight: 500;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ea580c 0%, #b91c1c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .fish-title {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-bottom: 6px;
            font-weight: 600;
        }

        input {
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            width: 100%;
        }

        input:focus {
            outline: none;
            border-color: #ea580c;
        }

        input.fish-input:focus {
            border-color: #0ea5e9;
        }

        .result-card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            margin-top: 10px;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .vs-card {
            background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
        }

        .fish-card {
            background: linear-gradient(135deg, #0f766e 0%, #0ea5e9 100%);
        }

        .big-percent {
            font-size: 3rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .sub-value {
            font-size: 0.95rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .comparison-box {
            background: #fff;
            padding: 30px;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
            margin-top: 20px;
            text-align: center;
        }

        .equiv-line {
            font-size: 1.5rem;
            margin-bottom: 15px;
            line-height: 1.4;
            font-weight: 500;
        }

        .equiv-line strong {
            color: #c2410c;
            font-weight: 800;
            font-size: 1.8rem;
        }

        .keg-icon {
            font-size: 4rem;
            display: block;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .locked-input {
            background: #f3f4f6;
            border-color: transparent;
            color: #4b5563;
            font-weight: 600;
        }

        .disclaimer {
            text-align: center;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 40px;
            margin-bottom: 40px;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }

            .big-percent {
                font-size: 2.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="nav-back">
            <a href="/">üè† Heim</a>
        </div>

        <h1>üç∫ Bj√≥r vs. √ûorskur üêü</h1>
        <div style="position: relative; margin-bottom: 30px;">
            <p class="subtitle">Skemmtista√∞urinn vs. √ötger√∞in.<br><span id="subtitle-text">Hva√∞ √æarf marga bj√≥rk√∫ta til
                    a√∞ borga s√∂mu skatta?</span></p>
            <button onclick="toggleMode()" style="
                background:white; border:2px solid #ea580c; color:#ea580c; 
                padding:8px 16px; border-radius:20px; font-weight:700; cursor:pointer; 
                position:absolute; right:0; top:0; font-size:0.9rem;
                display:flex; align-items:center; gap:5px;
            ">
                üîÑ Sn√∫a vi√∞
            </button>
        </div>

        <!-- FISHING SECTION (NORMAL MODE) -->
        <div id="fishing-input-section" class="section">
            <div class="section-header">
                <h2 class="section-title fish-title">üêü √ötger√∞in (√ûorskur)</h2>
            </div>

            <div class="input-grid">
                <div class="input-group">
                    <label>Aflaheimild (tonn)</label>
                    <input type="number" id="cod-tonnes" value="400" onkeyup="calc()" placeholder="0" class="fish-input"
                        style="font-size: 1.2rem; font-weight: 700;">
                </div>
                <div class="input-group">
                    <label>√Å√¶tla√∞ Aflaver√∞m√¶ti (kr)</label>
                    <input type="text" id="catch-value" disabled class="locked-input">
                </div>
                <div class="input-group">
                    <label>Nett√≥ Vei√∞igjald (kr)</label>
                    <input type="text" id="net-fee" disabled class="locked-input">
                </div>
            </div>

            <div class="result-card fish-card">
                <div>Vei√∞igj√∂ld sem % af ver√∞m√¶ti</div>
                <div class="big-percent" id="fish-percent">0.00%</div>
                <div class="sub-value">Mi√∞a√∞ vi√∞ 2026 taxta fyrir √æorsk og fulla n√Ωtingu √° fr√≠tekjumarki.</div>
            </div>
        </div>

        <!-- KEG SECTION (REVERSE MODE) -->
        <div id="keg-input-section" class="section hidden" style="border: 2px solid #ea580c;">
            <div class="section-header">
                <h2 class="section-title">üç∫ Skemmtista√∞urinn (Bj√≥r)</h2>
            </div>
            <div class="input-grid">
                <div class="input-group">
                    <label>Fj√∂ldi Bj√≥rk√∫ta (30L)</label>
                    <input type="number" id="kegs-input" value="300" onkeyup="calcReverse()" placeholder="0"
                        style="font-size: 1.2rem; font-weight: 700; color:#ea580c; border-color:#ea580c;">
                </div>
                <div class="input-group">
                    <label>S√∂luvir√∞i (kr)</label>
                    <input type="text" id="kegs-sales-value" disabled class="locked-input">
                </div>
                <div class="input-group">
                    <label>√Åfengisgjald (kr)</label>
                    <input type="text" id="kegs-tax-total" disabled class="locked-input">
                </div>
            </div>
            <div class="result-card vs-card">
                <div>√Åfengisgj√∂ld sem % af s√∂luvir√∞i</div>
                <div class="big-percent" id="kegs-percent">0.00%</div>
                <div class="sub-value" style="color:rgba(255,255,255,0.8)">(Mi√∞a√∞ vi√∞ √∫ts√∂luver√∞ 1.500 kr/0.5L)</div>
            </div>
        </div>

        <!-- PUNCHLINE SECTION -->
        <div class="section" style="border: 4px solid #ea580c; background: #fffaf0;" id="result-box">
            <div class="section-header" style="border-bottom: none; margin-bottom: 10px;">
                <h2 class="section-title" style="width:100%; text-align:center;">‚öñÔ∏è Jafngildi</h2>
            </div>

            <div class="comparison-box" style="border:none; background:transparent; margin-top:0; padding-top:0;">
                <p style="margin-bottom: 20px; font-size: 1.1rem; color: #4b5563;" id="comparison-text">
                    Til a√∞ r√≠ki√∞ f√°i s√∂mu tekjur √≠ √°fengisgj√∂ld og √∫tger√∞in borgar af √æessum afla...<br>
                    ...√æyrfti barinn a√∞ selja:
                </p>

                <!-- Normal Mode Result -->
                <div id="normal-result">
                    <div class="keg-icon">üõ¢Ô∏è</div>
                    <div class="equiv-line">
                        <strong id="equiv-kegs">0</strong> bj√≥rk√∫ta (30L)
                    </div>
                </div>

                <!-- Reverse Mode Result -->
                <div id="reverse-result" class="hidden">
                    <div class="keg-icon">üêü</div>
                    <div class="equiv-line">
                        √ötger√∞in √æyrfti a√∞ vei√∞a<br>
                        <strong id="equiv-tonnes" style="color:#0ea5e9;">0</strong> tonn af √æorski
                    </div>
                </div>

                <div style="font-size: 1rem; color: #6b7280; margin-top:10px;">(Mi√∞a√∞ vi√∞ 5% ABV)</div>
            </div>
        </div>

        <!-- ALCOHOL RATES REFERENCE -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üìä √Åfengisgj√∂ld (Reikniv√©l)</h2>
            </div>
            <p style="margin-bottom: 20px; color: #4b5563;">H√©r getur √æ√∫ s√©√∞ hva√∞ r√≠ki√∞ tekur af hverri v√∂rutegund mi√∞a√∞
                vi√∞ √°√¶tla√∞ s√∂luver√∞.</p>

            <div class="input-grid">
                <!-- BEER -->
                <div class="input-group" style="background:#f9fafb; padding:15px; border-radius:10px;">
                    <h4 style="margin-bottom:10px;">üç∫ Bj√≥r (5%)</h4>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>Ver√∞ (0.5L):</span> <input type="number" value="1500" id="beer-price"
                            onkeyup="calcRates()" style="width:80px; padding:6px;">
                    </div>
                    <div style="font-weight:700; color:#ea580c;" id="beer-tax-pct">Tax: 0%</div>
                </div>

                <!-- WINE -->
                <div class="input-group" style="background:#f9fafb; padding:15px; border-radius:10px;">
                    <h4 style="margin-bottom:10px;">üç∑ V√≠n (12%)</h4>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>Ver√∞ (0.75L):</span> <input type="number" value="2500" id="wine-price"
                            onkeyup="calcRates()" style="width:80px; padding:6px;">
                    </div>
                    <div style="font-weight:700; color:#ea580c;" id="wine-tax-pct">Tax: 0%</div>
                </div>

                <!-- SPIRITS -->
                <div class="input-group" style="background:#f9fafb; padding:15px; border-radius:10px;">
                    <h4 style="margin-bottom:10px;">ü•É Sterkt (40%)</h4>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span>Ver√∞ (0.7L):</span> <input type="number" value="9000" id="spirits-price"
                            onkeyup="calcRates()" style="width:80px; padding:6px;">
                    </div>
                    <div style="font-weight:700; color:#ea580c;" id="spirits-tax-pct">Tax: 0%</div>
                </div>
            </div>
        </div>


        <p class="disclaimer">
            <strong>Forsendur (2026):</strong><br>
            √ûorskur: Ver√∞ 405,15 kr/kg. Vei√∞igjald 50,79 kr/kg. Fr√≠tekjumark n√Ωtt a√∞ fullu (65%/45% reglur).<br>
            √Åfengisgjald: Bj√≥r 156,45 kr/cl, V√≠n 142,50 kr/cl, Sterkt 192,85 kr/cl.<br>
            √ûetta er einf√∂ldun, en s√Ωnir st√¶r√∞argr√°√∞una.
        </p>

    </div>

    <script>
        const fmt = (n) => Math.round(n).toLocaleString('is-IS');
        const parse = (id) => parseFloat(document.getElementById(id).value) || 0;

        // 2026 CONSTANTS
        const COD_PRICE = 405.15;
        const COD_FEE_RATE = 50.79;

        const RATE_BEER = 156.45;
        const RATE_WINE = 142.50;
        const RATE_SPIRITS = 192.85;

        // KEG CONSTANTS
        const KEG_LITERS = 30;
        const KEG_ABV = 5.0; // 5%
        // calc tax per keg once
        const KEG_TAX_PER_KEG = KEG_LITERS * KEG_ABV * RATE_BEER; // 30 * 5 * 156.45 = 23467.5

        // Retail estimates
        const RETAIL_PRICE_PER_PINT = 1500; // 0.5L
        const RETAIL_PRICE_PER_KEG = (KEG_LITERS / 0.5) * RETAIL_PRICE_PER_PINT; // 60 pints * 1500 = 90,000 kr

        // Default to Reverse Mode (Kegs -> Cod) as per user request
        let isReverse = true;

        function toggleMode() {
            isReverse = !isReverse;
            renderMode();
        }

        function renderMode() {
            const fishSection = document.getElementById('fishing-input-section');
            const kegSection = document.getElementById('keg-input-section');
            const normalResult = document.getElementById('normal-result');
            const reverseResult = document.getElementById('reverse-result');
            const subtitle = document.getElementById('subtitle-text');
            const resultBox = document.getElementById('result-box');

            if (isReverse) {
                // ESTABLISHED DEFAULT: KEG INPUT
                fishSection.classList.add('hidden');
                kegSection.classList.remove('hidden');
                normalResult.classList.add('hidden');
                reverseResult.classList.remove('hidden');

                subtitle.innerText = "Hversu miki√∞ √æarf √∫tger√∞in a√∞ vei√∞a til a√∞ borga s√∂mu skatta og barinn?";
                resultBox.style.borderColor = "#0ea5e9";

                document.getElementById('comparison-text').innerHTML =
                    "Til a√∞ r√≠ki√∞ f√°i s√∂mu tekjur √≠ vei√∞igj√∂ld og barinn skilar af √æessu magni...<br>...√æyrfti √∫tger√∞in a√∞ vei√∞a:";

                calcReverse();
            } else {
                // TOGGLED: FISH INPUT
                fishSection.classList.remove('hidden');
                kegSection.classList.add('hidden');
                normalResult.classList.remove('hidden');
                reverseResult.classList.add('hidden');

                subtitle.innerText = "Hva√∞ √æarf marga bj√≥rk√∫ta til a√∞ borga s√∂mu skatta?";
                resultBox.style.borderColor = "#ea580c";

                document.getElementById('comparison-text').innerHTML =
                    "Til a√∞ r√≠ki√∞ f√°i s√∂mu tekjur √≠ √°fengisgj√∂ld og √∫tger√∞in borgar af √æessum afla...<br>...√æyrfti barinn a√∞ selja:";

                calc();
            }
        }

        // ... (calc functions remain the same) ...

        // Helper to calc net fee from tonnes (used in binary search)
        function calculateNetFee(tonnes) {
            const kg = tonnes * 1000;
            const grossFee = kg * COD_FEE_RATE;

            let allowance = 0;
            const tier1 = Math.min(grossFee, 15_000_000);
            allowance += tier1 * 0.65;

            const remainder = Math.max(grossFee - 15_000_000, 0);
            allowance += 0.45 * Math.min(remainder, 40_000_000);

            return Math.max(0, grossFee - allowance);
        }

        function calc() {
            // 1. FISHING CALC (Normal Mode)
            const tonnes = parse('cod-tonnes');
            const kg = tonnes * 1000;
            const catchValue = kg * COD_PRICE;
            const netFee = calculateNetFee(tonnes); // use helper

            // Update UI
            document.getElementById('catch-value').value = fmt(catchValue) + ' kr';
            document.getElementById('net-fee').value = fmt(netFee) + ' kr';

            let fishPct = 0;
            if (catchValue > 0) fishPct = (netFee / catchValue) * 100;
            document.getElementById('fish-percent').innerText = fishPct.toFixed(2) + '%';

            // 2. EQUIVALENCY (KEGS)
            let kegs = 0;
            if (netFee > 0) {
                kegs = netFee / KEG_TAX_PER_KEG;
            }
            document.getElementById('equiv-kegs').innerText = fmt(kegs);
        }

        function calcReverse() {
            // 1. KEG INPUT (Reverse Mode)
            const kegs = parse('kegs-input');

            // Stats
            const totalTax = kegs * KEG_TAX_PER_KEG;
            const salesValue = kegs * RETAIL_PRICE_PER_KEG;

            let taxPct = 0;
            if (salesValue > 0) taxPct = (totalTax / salesValue) * 100;

            document.getElementById('kegs-sales-value').value = fmt(salesValue) + ' kr';
            document.getElementById('kegs-tax-total').value = fmt(totalTax) + ' kr';
            document.getElementById('kegs-percent').innerText = taxPct.toFixed(1) + '%';

            // 2. FIND TONNES needed to generate 'totalTax'
            // Since fee calculation is non-linear (tiers), we iterate or solve.
            // Function is monotonic increasing, so binary search fits.
            // Max typical fee? 
            // 1 ton cod ~ 400kg fee -> 20k fee approx.
            // 10,000 tons -> 200m fee.
            // Let's search 0 to 100,000 tons.

            let low = 0;
            let high = 100000;
            let foundTonnes = 0;

            for (let i = 0; i < 50; i++) { // 50 iter ample precision
                const mid = (low + high) / 2;
                const fee = calculateNetFee(mid);

                if (Math.abs(fee - totalTax) < 100) { // close enough result
                    foundTonnes = mid;
                    break;
                }

                if (fee < totalTax) {
                    low = mid;
                } else {
                    high = mid;
                }
                foundTonnes = mid;
            }

            document.getElementById('equiv-tonnes').innerText = fmt(foundTonnes);
        }

        function calcRates() {
            // Beer
            const bPrice = parse('beer-price'); // 0.5L
            const bTax = 0.5 * 5.0 * RATE_BEER;
            const bPct = (bTax / bPrice) * 100;
            document.getElementById('beer-tax-pct').innerText = `Gjald: ${bPct.toFixed(1)}%`;

            // Wine
            const wPrice = parse('wine-price'); // 0.75L
            const wTax = 0.75 * 12.0 * RATE_WINE;
            const wPct = (wTax / wPrice) * 100;
            document.getElementById('wine-tax-pct').innerText = `Gjald: ${wPct.toFixed(1)}%`;

            // Spirits
            const sPrice = parse('spirits-price'); // 0.7L
            const sTax = 0.7 * 40.0 * RATE_SPIRITS;
            const sPct = (sTax / sPrice) * 100;
            document.getElementById('spirits-tax-pct').innerText = `Gjald: ${sPct.toFixed(1)}%`;
        }

        // Init
        calc();
        calcRates();
    </script>
</body>

</html>